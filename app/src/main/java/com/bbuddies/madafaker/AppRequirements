# Mobile Random Message Social App â€“ Requirements  (v1.0)

---

## 1Â Â Product Vision

Deliver a lightâ€‘weight, lowâ€‘friction social experience where users broadcast a single line of text to strangers and receive unexpected thoughts in return. The app balances two contrasting moodsâ€”positive encouragement and uncensored catharsisâ€”while rewarding creativity and respectful engagement.

## 2Â Â Business Goals

1. **Daily Delight:**â€¯Drive habitual, microâ€‘time engagement (30â€‘60Â s sessions).
2. **Viral Growth Loop:**â€¯Pushâ€‘notification delivery of messages â†’ ratings â†’ wider distribution â†’ screenshots/shared quotes.
3. **Positive Netâ€‘Promoter Score:**â€¯Minimise harassment via optâ€‘in â€œShineâ€ mode and rateâ€‘gated exposure in â€œShadowâ€ mode.
4. **MonetisationÂ (PhaseÂ 2):**Â Sponsored prompts, coin packs for additional replies, themed UI skins.

## 3Â Â Personas & Useâ€‘Cases

| Persona                | Motivation                                  | Key Flows                                         |
| ---------------------- | ------------------------------------------- | ------------------------------------------------- |
| **The Supportâ€‘Seeker** | Wants to brighten someoneâ€™s day & feel good | Writes in *Shine*, rates messages, builds streaks |
| **The Ranter**         | Needs a safe outlet for spicy takes         | Writes in *Shadow*, hunts witty lines             |
| **The Lurker**         | Prefers reading & rating                    | Receives notifications, rarely writes             |

## 4Â Â MVP Feature Set

### 4.1 Onboarding & Tutorial Sequence
- **Multi-Page Intro:** A three-panel carousel explaining core mechanics:
  1. **Random Broadcast:** â€œWrite a short line. We'll deliver it randomly to active users.â€ Diagram of dots moving between devices.
  2. **Mode Toggle:** â€œDrag or tap the sun icon to switch modes.â€ Demo animation where the sun sinks and the moon emerges.
  3. **Receive & Rate:** â€œWhen messages arrive, read and rate them on a 5-point scale.â€ Includes swipe gesture visual.
- **Auto-Advance & Skip:** Panels auto-advance after 2â€“3 seconds; â€œSkipâ€ becomes available after the first panel.
- **Set Nickname Prompt:** Immediately after intro, show dialog for unique nickname (3â€“15 chars, emojis allowed) before landing on the main UI.
  - Footer contains a **Privacy Policy** link.
  - Push-notification permission request fires once nickname is confirmed.

### 4.2 UI Navigation Tabs

Establish four primary tabs in the bottom navigation bar to support the Writeâ€‘focused flow and clear separation of content:

| Position | Purpose                                        | Label    | Icon |
| -------- | ---------------------------------------------- | -------- | ---- |
| **1.**   | Compose and view your last 3 sent messages     | Write    | âœï¸   |
| **2.**   | Sent messages + their replies (tap for thread) | My Posts | ğŸ’¬   |
| **3.**   | Review messages youâ€™ve received                | Inbox    | ğŸ“¥   |
| **4.**   | Account settings and profile                   | Account  | ğŸ‘¤   |

Lock in the final labels as shown above before design review to finalize localization and iconography.

### 4.3 Error & Informational States
- **Offline send failure:** â€œFailed to send. Will retry...â€ (Background retry via WorkManager).
- **Nickname already taken:** Inline field error prompting a new name.
- **Moderation rejection (Shine):** Dialog suggests switching to Shadow mode if the user wants uncensored wording.
- **Push permission denied:** Snackbar outlining that pushes are essential to the experience and promising no spam, plus a button to open system settings.
- **No messages yet:** Friendly empty-state illustration with copy: â€œNo messages yet.â€

**Spam/Flood Control:** Backend enforces a **30-second** minimum interval between sends; returns HTTP 429 with a friendly error.

### 4.4Â  Account & Settings

- **Email sign-in:** Links messages across devices. Google signâ€‘in will be added in Phase 2.
- Avatar & 80â€‘char bio.
- LanguageÂ + Locale selector (default phone locale).

## 5Â Â Future (Postâ€‘MVP) Backlog

1. **Iterative Distribution:**Â â‰¥â€¯4â˜… average after firstÂ 10 ratings â‡’ resend toâ€¯Ã—10 users.
2. **Adaptive Notifications:**Â Behaviourâ€‘based quota (1â€‘4 per day).
3. **Locale Hints:**Â Keyboard language â‰  selected locale â‡’ prompt switch.
4. **Public Feed Experiment:**Â Top 50 daily messages in readâ€‘only feed.
5. **Moderation Dashboard:**Â Admin web panel, realâ€‘time abuse reports.
6. **Report / Block Abuse:** In-app â€œReportâ€ action on any message plus ability to mute sender. (PhaseÂ 2)

## 6Â Â Nonâ€‘Functional Requirements

- **Privacyâ€‘byâ€‘Design:**Â No PII required; nickname + token.
- **Latency:**Â <300Â ms API roundâ€‘trip for message send.
- **Scalability:** Use topic-based FCM for batched sends.
- **Legal:**Â Comply with GDPR/CCPA.
- **Accessibility:**Â WCAG 2.1 AA fonts & contrast.
- **Analytics:** Instrument Firebase Analytics to track key events (app_open, send_message, receive_notification, open_notification, dismiss_notification, rate_message, toggle_mode) and funnel metrics for ongoing product improvement.
- **Crash Reporting:** Integrate Firebase Crashlytics for real-time crash and ANR monitoring.
- **Spam/Flood Control:** 30-second minimum send interval enforced server-side.
- **Kotlin Multiplatform Preparedness:** Structure the Android codebase (business logic, network layer) to facilitate a future migration to Kotlin Multiplatform (KMP) for shared modules across mobile platforms.

### 6.1 Content Filtering for Shine Mode
To automatically moderate user-generated text in **Shine** mode with a lightweight integration, adopt a hybrid of server-side ML and client-side filtering:

| Tool / Service                   | Platform        | Key Features                                            | Integration Effort                      |
|----------------------------------|-----------------|---------------------------------------------------------|-----------------------------------------|
| **OpenAI Moderation API**        | Backend         | Multidimensional policy checks: abuse, hate, sexual, self-harm, profanity | Single REST call to `/moderations`; free and unlimited usage (no token quota) |
| **Firebase ML Kit Profanity Filter** | Mobile (Android)| On-device simple profanity blacklist; instant feedback | Add ML Kit SDK + Profanity Extension     |

**Recommended MVP Approach:**
1. **Server-Side Enforcement:** For every Shine-mode submission, call the **OpenAI Moderation API**. If any category (e.g., profanity, hate) exceeds the threshold (e.g., 0.6), reject with a user-friendly error: â€œPlease keep it positive!â€
2. **Client-Side Quick Check:** Use **Firebase ML Kit Profanity Filter** in the Android app to flag disallowed words instantly, helping users self-correct before sending.
3. **Custom Blocklist (Optional):** Maintain a small server-hosted JSON list of brand- or culture-specific banned terms; screen messages against it post-API check.

This hybrid solution gives robust, free moderation out of the box, minimizes false positives through client prompts, and keeps your server code simple.

## 7Â Â Technical Architecture (High-Level)

```mermaid
flowchart TD
  Mobile(Android) -- REST/JSON --> API(Gateway)
  API --> Node(NestJS Service Cluster)
  Node -- ORM --> DB(PostgreSQL)
  Node --> FCM(Push)
  Cron(Scheduled Jobs) --> Node
```

- **Security:**Â Bearer `token` header for user JWT; `x-api-key` for cron jobs.
- **Data Storage:** **Users, Messages, Replies, Ratings tables (see Â§8).**
- **Push Delivery:** Outgoing messages are delivered via Firebase Cloud Messaging (FCM) to **randomly selected** active users within the same mode.

## 8Â Â Data Model Summary

| Entity      | Key Fields                                | Relations                 |
| ----------- | ----------------------------------------- | ------------------------- |
| **User**    | idÂ UUID, name, registrationToken          | 1â€‘* Message, 1â€‘* Reply    |
| **Message** | id, body, mode, public, authorId, wasSent | *â€‘1 User, 1â€‘* Reply       |
| **Reply**   | id, body, public, parentId, authorId      | *â€‘1 Message, selfâ€‘nested  |
| **Rating**  | userId, messageId, value                  |Â FK â†’ User, Message        |

## 9Â Â API Contract Coverage (Postman)

- **User:**Â create, currentÂ GET/PATCH, checkâ€‘name.
- **Message:**Â create, rate, list incoming/outgoing.
- **Reply:**Â create, update, fetch byÂ ID.
- **Cron:**Â `/api/cron/send-messages` (protected).

## 10Â Â Naming â€“ Modes

| Positive Mode | Unfiltered Mode |
| ------------- | --------------- |
| **Shine**     | **Shadow**      |

*(Locked for MVP)*

## 11Â Â Resolved Decisions

1. **Maximum daily sends per user:** Limited to 10 messages per day in PhaseÂ 1.
2. **Shadow mode content filtering:** Explicit illegal content will still be filtered, with stricter enforcement beginning in PhaseÂ 2.
3. **Economy mechanics (coin sink/inflation control):** Deferred to PhaseÂ 2 backlog.
4. **Translation vs. locale restriction:** ML-driven autoâ€‘detect deferred to PhaseÂ 2.
5. **Tablet / foldable layouts:** Not a priority for MVP.

---

**Next Step:** Review & annotate this draft â†’ confirm MVP scope â†’ derive sprint backlog & detailed API specs.